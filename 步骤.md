#### 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆä½¿ç”¨æ­£ç¡®çš„å‚æ•°ï¼‰

```
python3 -m venv venv_checkin_server
```

#### 2. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ

```
source venv_checkin_server/bin/activate
```

#### 3. å®‰è£…ä¾èµ–

```
pip install fastapi uvicorn apscheduler requests
```

#### 4. å¯åŠ¨æœåŠ¡ å¼ºåˆ¶ç”¨å½“å‰ Python å¯åŠ¨ uvicorn

```
python -m uvicorn app:app --host 0.0.0.0 --port 8000 --reload
```

#### 5. ç›´æ¥è¿è¡Œ start_checkin.sh ä¸€ç›´è¿è¡ŒæœåŠ¡

æ˜ç™½ï¼Œæˆ‘å¸®ä½ åšä¸€ä¸ª Mac å¼€æœºè‡ªå¯åŠ¨ç‰ˆæœ¬ï¼Œè®©ä½ çš„ FastAPI æœåŠ¡è‡ªåŠ¨å¯åŠ¨ã€åå°è¿è¡Œã€æ—¥å¿—è®°å½•ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œã€‚

æˆ‘ä»¬ç”¨ launchdï¼ˆMac è‡ªå¸¦å¼€æœºæœåŠ¡ç®¡ç†ï¼‰ï¼Œè¿™æ˜¯æœ€ç¨³å¦¥ã€æ— éœ€ç¬¬ä¸‰æ–¹å·¥å…·çš„æ–¹æ³•ã€‚

ä¸€ã€åˆ›å»º launchd é…ç½®æ–‡ä»¶

æ‰“å¼€ç»ˆç«¯ï¼š

```
mkdir -p ~/Library/LaunchAgents
cd ~/Library/LaunchAgents
```

åˆ›å»ºé…ç½®æ–‡ä»¶ com.checkin.server.plistï¼š

```
nano com.checkin.server.plist
```

ç²˜è´´ä»¥ä¸‹å†…å®¹ï¼ˆè¯·æ ¹æ®ä½ çš„è·¯å¾„ä¿®æ”¹ï¼‰ï¼š

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>Label</key>
    <string>com.checkin.server</string>

    <key>ProgramArguments</key>
    <array>
        <string>/Users/andy/Documents/MyServers/checkin_server/venv_checkin_server/bin/python</string>
        <string>-m</string>
        <string>uvicorn</string>
        <string>/Users/andy/Documents/MyServers/checkin_server/app:app</string>
        <string>--host</string>
        <string>0.0.0.0</string>
        <string>--port</string>
        <string>8000</string>
    </array>

    <key>WorkingDirectory</key>
    <string>/Users/andy/Documents/MyServers/checkin_server</string>

    <key>StandardOutPath</key>
    <string>/Users/andy/Documents/MyServers/checkin_server/server.log</string>
    <key>StandardErrorPath</key>
    <string>/Users/andy/Documents/MyServers/checkin_server/server.log</string>

    <key>RunAtLoad</key>
    <true/>

    <key>KeepAlive</key>
    <true/>

</dict>
</plist>
```

âœ… è¯´æ˜ï¼š

ProgramArguments â†’ ä½ å¯åŠ¨æœåŠ¡çš„å®Œæ•´å‘½ä»¤

WorkingDirectory â†’ é¡¹ç›®ç›®å½•

StandardOutPath / StandardErrorPath â†’ æ—¥å¿—æ–‡ä»¶

RunAtLoad â†’ å¼€æœºè‡ªåŠ¨å¯åŠ¨

KeepAlive â†’ æœåŠ¡æ„å¤–é€€å‡ºè‡ªåŠ¨é‡å¯

ä¿å­˜é€€å‡ºï¼ˆCtrl+O â†’ Enter â†’ Ctrl+Xï¼‰ã€‚

äºŒã€åŠ è½½å¹¶å¯åŠ¨æœåŠ¡

# è®© launchd åŠ è½½æœåŠ¡

```
launchctl load ~/Library/LaunchAgents/com.checkin.server.plist
```

# å¯åŠ¨æœåŠ¡ï¼ˆå¦‚æœæ²¡æœ‰è‡ªåŠ¨å¯åŠ¨ï¼‰

```
launchctl start com.checkin.server
```

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```
launchctl list | grep checkin
```

âœ… å¦‚æœæœåŠ¡å¯åŠ¨æ­£å¸¸ï¼Œæ—¥å¿—ä¼šå†™å…¥ server.log

âœ… KeepAlive ä¼šä¿è¯æœåŠ¡æŒ‚æ‰åè‡ªåŠ¨é‡å¯

ä¸‰ã€åœæ­¢æˆ–å¸è½½æœåŠ¡

# åœæ­¢æœåŠ¡

```
launchctl stop com.checkin.server
```

# å¸è½½æœåŠ¡ï¼ˆå¼€æœºä¸å†å¯åŠ¨ï¼‰

```
launchctl unload ~/Library/LaunchAgents/com.checkin.server.plist
```

å››ã€æŸ¥çœ‹æ—¥å¿—

```
tail -f /Users/andy/Documents/MyServers/checkin_server/server.log
```

#### ä¿®æ”¹ py ä»£ç åé‡å¯

```
launchctl unload ~/Library/LaunchAgents/com.checkin.server.plist  # å¸è½½æ—§çš„
launchctl load ~/Library/LaunchAgents/com.checkin.server.plist    # é‡æ–°åŠ è½½
launchctl start com.checkin.server
```

### æœ¬åœ°è·‘èµ·æ¥åå†…ç½‘ç©¿é€åˆ°å¤–ç½‘çš„æ­¥éª¤

äºŒã€å‰ç½®æ¡ä»¶ç¡®è®¤ï¼ˆä½ åŸºæœ¬éƒ½æ»¡è¶³äº†ï¼‰

âœ… ä½ å·²ç»æœ‰åŸŸåï¼štravelhelper.top

âœ… FastAPI åœ¨æœ¬åœ°è·‘åœ¨ï¼šhttp://127.0.0.1:8000

âœ… Mac / Linuxï¼ˆä½ æ˜¯ macOSï¼‰

ä¸‰ã€Step 1ï¼šæŠŠåŸŸåæ‰˜ç®¡åˆ° Cloudflareï¼ˆä¸€æ¬¡æ€§ï¼‰

å¦‚æœä½ å·²ç»åœ¨ Cloudflare ğŸ‘‰ è·³è¿‡
å¦‚æœè¿˜æ²¡ï¼š

æ‰“å¼€ï¼šhttps://dash.cloudflare.com

æ·»åŠ ç«™ç‚¹ï¼štravelhelper.top

æŒ‰æç¤ºæŠŠ åŸŸå NS æœåŠ¡å™¨ æ”¹æˆ Cloudflare ç»™ä½ çš„

ç­‰å‡ åˆ†é’Ÿç”Ÿæ•ˆ

âš ï¸ è¿™æ˜¯å¿…é¡»çš„ï¼Œå› ä¸º Tunnel åªèƒ½é…åˆ Cloudflare DNS

å››ã€Step 2ï¼šå®‰è£… cloudflaredï¼ˆMacï¼‰

```
brew install cloudflare/cloudflared
```

éªŒè¯ï¼š

```
cloudflared version
```

äº”ã€Step 3ï¼šç™»å½• Cloudflareï¼ˆä¸€æ¬¡ï¼‰

```
cloudflared tunnel login
```

å…­ã€Step 4ï¼šåˆ›å»º Tunnel

```
cloudflared tunnel create checkin-api

```

ä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š

```
Tunnel credentials written to:
~/.cloudflared/xxxxxxxx-xxxx-xxxx.json
```

è®°ä½è¿™ä¸ª Tunnel ID
ä¸ƒã€Step 5ï¼šé…ç½®åŸŸå â†’ æœ¬åœ°æœåŠ¡æ˜ å°„

åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š

```
mkdir -p ~/.cloudflared
nano ~/.cloudflared/config.yml
```

ä¿å­˜å¹¶é€€å‡ºç¼–è¾‘æ¨¡å¼ `control + O` + å›è½¦ + `control + X`
å†…å®¹ ğŸ‘‡ï¼ˆé‡ç‚¹ï¼‰ï¼š

```
tunnel: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxx
credentials-file: /Users/andy/.cloudflared/xxxxxxxx-xxxx-xxxx.json

ingress:
  - hostname: api.travelhelper.top
    service: http://127.0.0.1:8000
  - service: http_status:404
```

âš ï¸

hostname å¯ä»¥æ”¹æˆ api.travelhelper.top

service æŒ‡å‘ä½  æœ¬åœ° FastAPI

ä¹ã€Step 7ï¼šå¯åŠ¨ Tunnelï¼ˆè§è¯å¥‡è¿¹ï¼‰

```
cloudflared tunnel run checkin-api
```

ç°åœ¨è®¿é—®ï¼š

```
https://api.travelhelper.top/docs
```

ğŸ‰ ä½ ä¼šçœ‹åˆ° FastAPI Swaggerï¼

åã€Step 8ï¼ˆé‡è¦ï¼‰ï¼šè®© Tunnel å¸¸é©»è¿è¡Œ æˆ–è€… æ–­ç½‘å é‡å¯å¯åŠ¨
æ–¹å¼ Aï¼ˆæ¨èï¼‰ï¼špm2

```
npm install -g pm2
```

```
pm2 start cloudflared --name checkin-tunnel -- tunnel run checkin-api
pm2 save
```

å¼€æœºè‡ªå¯ï¼š

```
pm2 startup
```

åä¸€ã€ä½ ç°åœ¨å¯ä»¥ç›´æ¥ç”¨åŸŸåè°ƒæ¥å£äº†
ç¤ºä¾‹ï¼šæµ‹è¯•ç­¾åˆ°æ¥å£

```
curl -X POST https://api.travelhelper.top/api/checkin \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","date":"2026-01-13"}'
```
